<!DOCTYPE html>
<!-- saved from url=(0053)http://www.runoob.com/kotlin/kotlin-basic-syntax.html -->
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Kotlin 委托</title>

	  <link rel="dns-prefetch" href="http://s.w.org/">

		<link rel="stylesheet" href="./css2/style.css" type="text/css" media="all">
		<link rel="stylesheet" href="./css2/font-awesome.min.css" media="all">
		<link rel="stylesheet" type="text/css" href="./css2/prettify.css">
	</head>
<body style="">

<!--  头部 -->

<!-- 导航栏 -->

<div class="container main">
	<!-- 中间 -->
	<div class="row">

<div class="col left-column">

	<div class="sidebar-box gallery-list">

	</div>
</div>
<div class="col middle-column">

<div class="article">
			<div class="article-heading-ad" style="display: none;">

		</div>

		<div class="article-body">

			<div class="article-intro" id="content">

			<h1>kotlin 委托</h1>
<p><a href="http://www.runoob.com/w3cnote/delegate-mode.html" target="_blank">委托模式</a>是软件设计模式中的一项基本技巧。在委托模式中，有两个对象参与处理同一个请求，接受请求的对象将请求委托给另一个对象来处理。</p>
<p>Kotlin 直接支持委托模式，更加优雅，简洁。Kotlin 通过关键字 by 实现委托。</p>
<hr><h2>类委托</h2>
<p>类的委托即一个类中定义的方法实际是调用另一个类的对象的方法来实现的。</p>
<p>以下实例中派生类 Derived 继承了接口 Base 所有方法，并且委托一个传入的 Base 类的对象来执行这些方法。</p>
<pre class="prettyprint prettyprinted" style=""><span class="com">// 创建接口</span><span class="pln">
</span><span class="kwd">interface</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    fun </span><span class="kwd">print</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// 实现此接口的被委托的类</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">BaseImpl</span><span class="pun">(</span><span class="pln">val x</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Int</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">override</span><span class="pln"> fun </span><span class="kwd">print</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">print</span><span class="pun">(</span><span class="pln">x</span><span class="pun">)</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// 通过关键字 by 建立委托类</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Derived</span><span class="pun">(</span><span class="pln">b</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Base</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="typ">Base</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> b

fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val b </span><span class="pun">=</span><span class="pln"> </span><span class="typ">BaseImpl</span><span class="pun">(</span><span class="lit">10</span><span class="pun">)</span><span class="pln">
    </span><span class="typ">Derived</span><span class="pun">(</span><span class="pln">b</span><span class="pun">).</span><span class="kwd">print</span><span class="pun">()</span><span class="pln"> </span><span class="com">// 输出 10</span><span class="pln">
</span><span class="pun">}</span></pre>
<p>
在 Derived 声明中，by 子句表示，将 b 保存在 Derived 的对象实例内部，而且编译器将会生成继承自 Base 接口的所有方法, 并将调用转发给 b。
</p><hr><h2>属性委托</h2>
<p>属性委托指的是一个类的某个属性值不是在类中直接进行定义，而是将其托付给一个代理类，从而实现对该类的属性统一管理。</p>
<p>属性委托语法格式：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">val</span><span class="pun">/</span><span class="kwd">var</span><span class="pln"> </span><span class="pun">&lt;属性名&gt;:</span><span class="pln"> </span><span class="pun">&lt;类型&gt;</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="pun">&lt;表达式&gt;</span></pre>
<ul>
<li>var/val：属性类型(可变/只读)</li>
<li>属性名：属性名称</li>
<li>类型：属性的数据类型</li>
<li>表达式：委托代理类</li>
</ul>
<p>by 关键字之后的表达式就是委托, 属性的 get() 方法(以及set() 方法)将被委托给这个对象的 getValue() 和 setValue() 方法。属性委托不必实现任何接口, 但必须提供 getValue() 函数(对于 var属性,还需要 setValue() 函数)。</p>
<h3>定义一个被委托的类</h3>
<p>该类需要包含 getValue() 方法和 setValue() 方法，且参数 thisRef 为进行委托的类的对象，prop 为进行委托的属性的对象。</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">reflect</span><span class="pun">.</span><span class="typ">KProperty</span><span class="pln">
</span><span class="com">// 定义包含属性委托的类</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Example</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> p</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Delegate</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// 委托的类</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">Delegate</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">operator</span><span class="pln"> fun getValue</span><span class="pun">(</span><span class="pln">thisRef</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?,</span><span class="pln"> </span><span class="kwd">property</span><span class="pun">:</span><span class="pln"> </span><span class="typ">KProperty</span><span class="pun">&lt;*&gt;):</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"$thisRef, 这里委托了 ${property.name} 属性"</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">operator</span><span class="pln"> fun setValue</span><span class="pun">(</span><span class="pln">thisRef</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?,</span><span class="pln"> </span><span class="kwd">property</span><span class="pun">:</span><span class="pln"> </span><span class="typ">KProperty</span><span class="pun">&lt;*&gt;,</span><span class="pln"> value</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">"$thisRef 的 ${property.name} 属性赋值为 $value"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">
fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val e </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Example</span><span class="pun">()</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">p</span><span class="pun">)</span><span class="pln">     </span><span class="com">// 访问该属性，调用 getValue() 函数</span><span class="pln">

    e</span><span class="pun">.</span><span class="pln">p </span><span class="pun">=</span><span class="pln"> </span><span class="str">"Runoob"</span><span class="pln">   </span><span class="com">// 调用 setValue() 函数</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">e</span><span class="pun">.</span><span class="pln">p</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre>
<p>输出结果为：</p>
<pre class="prettyprint prettyprinted" style=""><span class="typ">Example@433c675d</span><span class="pun">,</span><span class="pln"> </span><span class="pun">这里委托了</span><span class="pln"> p </span><span class="pun">属性</span><span class="pln">
</span><span class="typ">Example@433c675d</span><span class="pln"> </span><span class="pun">的</span><span class="pln"> p </span><span class="pun">属性赋值为</span><span class="pln"> </span><span class="typ">Runoob</span><span class="pln">
</span><span class="typ">Example@433c675d</span><span class="pun">,</span><span class="pln"> </span><span class="pun">这里委托了</span><span class="pln"> p </span><span class="pun">属性</span></pre>
<hr>
<h2>标准委托</h2>
<p>Kotlin 的标准库中已经内置了很多工厂方法来实现属性的委托。</p>
<h3>延迟属性 Lazy</h3>
<p>lazy() 是一个函数, 接受一个 Lambda 表达式作为参数, 返回一个 Lazy &lt;T&gt; 实例的函数，返回的实例可以作为实现延迟属性的委托： 第一次调用 get() 会执行已传递给 lazy() 的 lamda 表达式并记录结果， 后续调用 get() 只是返回记录的结果。</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">val lazyValue</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> lazy </span><span class="pun">{</span><span class="pln">
    println</span><span class="pun">(</span><span class="str">"computed!"</span><span class="pun">)</span><span class="pln">     </span><span class="com">// 第一次调用输出，第二次调用不执行</span><span class="pln">
    </span><span class="str">"Hello"</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">lazyValue</span><span class="pun">)</span><span class="pln">   </span><span class="com">// 第一次执行，执行两次输出表达式</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">lazyValue</span><span class="pun">)</span><span class="pln">   </span><span class="com">// 第二次执行，只输出返回值</span><span class="pln">
</span><span class="pun">}</span></pre>
<p>执行输出结果：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">computed</span><span class="pun">!</span><span class="pln">
</span><span class="typ">Hello</span><span class="pln">
</span><span class="typ">Hello</span></pre>
<hr>
<h2>可观察属性 Observable</h2>
<p>observable 可以用于实现观察者模式。</p>
<p>Delegates.observable() 函数接受两个参数: 第一个是初始化值, 第二个是属性值变化事件的响应器(handler)。</p>
<p>在属性赋值后会执行事件的响应器(handler)，它有三个参数：被赋值的属性、旧值和新值：</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">import</span><span class="pln"> kotlin</span><span class="pun">.</span><span class="pln">properties</span><span class="pun">.</span><span class="typ">Delegates</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">User</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Delegates</span><span class="pun">.</span><span class="pln">observable</span><span class="pun">(</span><span class="str">"初始值"</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        prop</span><span class="pun">,</span><span class="pln"> old</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln">
        println</span><span class="pun">(</span><span class="str">"旧值：$old -&gt; 新值：$new"</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val user </span><span class="pun">=</span><span class="pln"> </span><span class="typ">User</span><span class="pun">()</span><span class="pln">
    user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"第一次赋值"</span><span class="pln">
    user</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> </span><span class="str">"第二次赋值"</span><span class="pln">
</span><span class="pun">}</span></pre><p>执行输出结果：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">旧值：初始值</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">新值：第一次赋值</span><span class="pln">
</span><span class="pun">旧值：第一次赋值</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="pun">新值：第二次赋值</span></pre>
<hr>
<h2>把属性储存在映射中</h2>
<p>一个常见的用例是在一个映射（map）里存储属性的值。 这经常出现在像解析 JSON 或者做其他"动态"事情的应用中。 在这种情况下，你可以使用映射实例自身作为委托来实现委托属性。
</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">Site</span><span class="pun">(</span><span class="pln">val map</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Map</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> map
    val url</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln">  </span><span class="kwd">by</span><span class="pln"> map
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// 构造函数接受一个映射参数</span><span class="pln">
    val site </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Site</span><span class="pun">(</span><span class="pln">mapOf</span><span class="pun">(</span><span class="pln">
        </span><span class="str">"name"</span><span class="pln"> to </span><span class="str">"菜鸟教程"</span><span class="pun">,</span><span class="pln">
        </span><span class="str">"url"</span><span class="pln">  to </span><span class="str">"www.runoob.com"</span><span class="pln">
    </span><span class="pun">))</span><span class="pln">

    </span><span class="com">// 读取映射值</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">url</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre><p>执行输出结果：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">菜鸟教程</span><span class="pln">
www</span><span class="pun">.</span><span class="pln">runoob</span><span class="pun">.</span><span class="pln">com</span></pre>
<p>如果使用  var 属性，需要把 Map 换成 MutableMap：</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">Site</span><span class="pun">(</span><span class="pln">val map</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MutableMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> map
    val url</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> map
</span><span class="pun">}</span><span class="pln">

fun main</span><span class="pun">(</span><span class="pln">args</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Array</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">

    </span><span class="kwd">var</span><span class="pln"> map</span><span class="pun">:</span><span class="typ">MutableMap</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Any</span><span class="pun">?&gt;</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> mutableMapOf</span><span class="pun">(</span><span class="pln">
            </span><span class="str">"name"</span><span class="pln"> to </span><span class="str">"菜鸟教程"</span><span class="pun">,</span><span class="pln">
            </span><span class="str">"url"</span><span class="pln"> to </span><span class="str">"www.runoob.com"</span><span class="pln">
    </span><span class="pun">)</span><span class="pln">

    val site </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Site</span><span class="pun">(</span><span class="pln">map</span><span class="pun">)</span><span class="pln">

    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">url</span><span class="pun">)</span><span class="pln">

    println</span><span class="pun">(</span><span class="str">"--------------"</span><span class="pun">)</span><span class="pln">
    map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"name"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"Google"</span><span class="pun">)</span><span class="pln">
    map</span><span class="pun">.</span><span class="pln">put</span><span class="pun">(</span><span class="str">"url"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"www.google.com"</span><span class="pun">)</span><span class="pln">

    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
    println</span><span class="pun">(</span><span class="pln">site</span><span class="pun">.</span><span class="pln">url</span><span class="pun">)</span><span class="pln">

</span><span class="pun">}</span></pre><p>执行输出结果：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pun">菜鸟教程</span><span class="pln">
www</span><span class="pun">.</span><span class="pln">runoob</span><span class="pun">.</span><span class="pln">com
</span><span class="pun">--------------</span><span class="pln">
</span><span class="typ">Google</span><span class="pln">
www</span><span class="pun">.</span><span class="pln">google</span><span class="pun">.</span><span class="pln">com</span></pre>
<hr>
<h2>Not Null
</h2><p>notNull 适用于那些无法在初始化阶段就确定属性值的场合。
</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">Foo</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> notNullBar</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">Delegates</span><span class="pun">.</span><span class="pln">notNull</span><span class="pun">&lt;</span><span class="typ">String</span><span class="pun">&gt;()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

foo</span><span class="pun">.</span><span class="pln">notNullBar </span><span class="pun">=</span><span class="pln"> </span><span class="str">"bar"</span><span class="pln">
println</span><span class="pun">(</span><span class="pln">foo</span><span class="pun">.</span><span class="pln">notNullBar</span><span class="pun">)</span></pre><p>需要注意，如果属性在赋值前就被访问的话则会抛出异常。</p>
<hr>
<h2>局部委托属性</h2>
<p>你可以将局部变量声明为委托属性。 例如，你可以使一个局部变量惰性初始化：</p>
<pre class="prettyprint prettyprinted" style=""><span class="pln">fun example</span><span class="pun">(</span><span class="pln">computeFoo</span><span class="pun">:</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span class="pln"> </span><span class="typ">Foo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val memoizedFoo </span><span class="kwd">by</span><span class="pln"> lazy</span><span class="pun">(</span><span class="pln">computeFoo</span><span class="pun">)</span><span class="pln">

    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">someCondition </span><span class="pun">&amp;&amp;</span><span class="pln"> memoizedFoo</span><span class="pun">.</span><span class="pln">isValid</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        memoizedFoo</span><span class="pun">.</span><span class="pln">doSomething</span><span class="pun">()</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></pre><p>memoizedFoo 变量只会在第一次访问时计算。 如果 someCondition 失败，那么该变量根本不会计算。</p>
<hr>
<h2>属性委托要求</h2>
<p>对于只读属性(也就是说val属性), 它的委托必须提供一个名为getValue()的函数。该函数接受以下参数：</p>
<ul>
<li>thisRef —— 必须与属性所有者类型（对于扩展属性——指被扩展的类型）相同或者是它的超类型</li><li>
property —— 必须是类型 KProperty&lt;*&gt; 或其超类型</li></ul><p>
这个函数必须返回与属性相同的类型（或其子类型）。</p>
<p>对于一个值可变(mutable)属性(也就是说,var 属性),除 getValue()函数之外,它的委托还必须 另外再提供一个名为setValue()的函数, 这个函数接受以下参数:</p>
<ul>
<li.thisref ——="" 必须与属性所有者="" 类型（对于扩展属性——指被扩展的类型）相同或者是它的超类型<="" li=""><li>
property —— 必须是类型 KProperty&lt;*&gt; 或其超类型</li><li>
new value —— 必须和属性同类型或者是它的超类型。</li></li.thisref></ul>
<hr>
<h2>翻译规则</h2>
<p>在每个委托属性的实现的背后，Kotlin 编译器都会生成辅助属性并委托给它。 例如，对于属性 prop，生成隐藏属性 prop$delegate，而访问器的代码只是简单地委托给这个附加属性：</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> prop</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">MyDelegate</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// 这段是由编译器生成的相应代码：</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> val prop$delegate </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MyDelegate</span><span class="pun">()</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> prop</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Type</span><span class="pln">
        </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> prop$delegate</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">prop</span><span class="pun">)</span><span class="pln">
        </span><span class="kwd">set</span><span class="pun">(</span><span class="pln">value</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Type</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> prop$delegate</span><span class="pun">.</span><span class="pln">setValue</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">prop</span><span class="pun">,</span><span class="pln"> value</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre><p>Kotlin 编译器在参数中提供了关于 prop 的所有必要信息：第一个参数 this 引用到外部类 C 的实例而 this::prop 是 KProperty 类型的反射对象，该对象描述 prop 自身。</p>
<hr>
<h2>提供委托</h2>
<p>
通过定义 provideDelegate 操作符，可以扩展创建属性实现所委托对象的逻辑。 如果 by 右侧所使用的对象将 provideDelegate 定义为成员或扩展函数，那么会调用该函数来 创建属性委托实例。
</p><p>
provideDelegate 的一个可能的使用场景是在创建属性时（而不仅在其 getter 或 setter 中）检查属性一致性。
</p><p>
例如，如果要在绑定之前检查属性名称，可以这样写：</p><pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">ResourceLoader</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="typ">ResourceID</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">operator</span><span class="pln"> fun provideDelegate</span><span class="pun">(</span><span class="pln">
            thisRef</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MyUI</span><span class="pun">,</span><span class="pln">
            prop</span><span class="pun">:</span><span class="pln"> </span><span class="typ">KProperty</span><span class="pun">&lt;*&gt;</span><span class="pln">
    </span><span class="pun">):</span><span class="pln"> </span><span class="typ">ReadOnlyProperty</span><span class="pun">&lt;</span><span class="typ">MyUI</span><span class="pun">,</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        checkProperty</span><span class="pun">(</span><span class="pln">thisRef</span><span class="pun">,</span><span class="pln"> prop</span><span class="pun">.</span><span class="pln">name</span><span class="pun">)</span><span class="pln">
        </span><span class="com">// 创建委托</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">private</span><span class="pln"> fun checkProperty</span><span class="pun">(</span><span class="pln">thisRef</span><span class="pun">:</span><span class="pln"> </span><span class="typ">MyUI</span><span class="pun">,</span><span class="pln"> name</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">……</span><span class="pln"> </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> bindResource</span><span class="pun">(</span><span class="pln">id</span><span class="pun">:</span><span class="pln"> </span><span class="typ">ResourceID</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;):</span><span class="pln"> </span><span class="typ">ResourceLoader</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="pun">……</span><span class="pln"> </span><span class="pun">}</span><span class="pln">

</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyUI</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val image </span><span class="kwd">by</span><span class="pln"> bindResource</span><span class="pun">(</span><span class="typ">ResourceID</span><span class="pun">.</span><span class="pln">image_id</span><span class="pun">)</span><span class="pln">
    val text </span><span class="kwd">by</span><span class="pln"> bindResource</span><span class="pun">(</span><span class="typ">ResourceID</span><span class="pun">.</span><span class="pln">text_id</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre><p>provideDelegate 的参数与 getValue 相同：
</p><ul><li>
thisRef —— 必须与 属性所有者 类型（对于扩展属性——指被扩展的类型）相同或者是它的超类型</li><li>
property —— 必须是类型 KProperty&lt;*&gt; 或其超类型。</li></ul><p>
在创建 MyUI 实例期间，为每个属性调用 provideDelegate 方法，并立即执行必要的验证。
</p><p>
如果没有这种拦截属性与其委托之间的绑定的能力，为了实现相同的功能， 你必须显式传递属性名，这不是很方便：</p><pre class="prettyprint prettyprinted" style=""><span class="com">// 检查属性名称而不使用“provideDelegate”功能</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> </span><span class="typ">MyUI</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    val image </span><span class="kwd">by</span><span class="pln"> bindResource</span><span class="pun">(</span><span class="typ">ResourceID</span><span class="pun">.</span><span class="pln">image_id</span><span class="pun">,</span><span class="pln"> </span><span class="str">"image"</span><span class="pun">)</span><span class="pln">
    val text </span><span class="kwd">by</span><span class="pln"> bindResource</span><span class="pun">(</span><span class="typ">ResourceID</span><span class="pun">.</span><span class="pln">text_id</span><span class="pun">,</span><span class="pln"> </span><span class="str">"text"</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

fun </span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">MyUI</span><span class="pun">.</span><span class="pln">bindResource</span><span class="pun">(</span><span class="pln">
        id</span><span class="pun">:</span><span class="pln"> </span><span class="typ">ResourceID</span><span class="pun">&lt;</span><span class="pln">T</span><span class="pun">&gt;,</span><span class="pln">
        propertyName</span><span class="pun">:</span><span class="pln"> </span><span class="typ">String</span><span class="pln">
</span><span class="pun">):</span><span class="pln"> </span><span class="typ">ReadOnlyProperty</span><span class="pun">&lt;</span><span class="typ">MyUI</span><span class="pun">,</span><span class="pln"> T</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   checkProperty</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> propertyName</span><span class="pun">)</span><span class="pln">
   </span><span class="com">// 创建委托</span><span class="pln">
</span><span class="pun">}</span></pre><p>在生成的代码中，会调用 provideDelegate 方法来初始化辅助的 prop$delegate 属性。 比较对于属性声明 val prop: Type by MyDelegate() 生成的代码与 上面（当 provideDelegate 方法不存在时）生成的代码：
</p>
<pre class="prettyprint prettyprinted" style=""><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">var</span><span class="pln"> prop</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Type</span><span class="pln"> </span><span class="kwd">by</span><span class="pln"> </span><span class="typ">MyDelegate</span><span class="pun">()</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="com">// 这段代码是当“provideDelegate”功能可用时</span><span class="pln">
</span><span class="com">// 由编译器生成的代码：</span><span class="pln">
</span><span class="kwd">class</span><span class="pln"> C </span><span class="pun">{</span><span class="pln">
    </span><span class="com">// 调用“provideDelegate”来创建额外的“delegate”属性</span><span class="pln">
    </span><span class="kwd">private</span><span class="pln"> val prop$delegate </span><span class="pun">=</span><span class="pln"> </span><span class="typ">MyDelegate</span><span class="pun">().</span><span class="pln">provideDelegate</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">prop</span><span class="pun">)</span><span class="pln">
    val prop</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Type</span><span class="pln">
        </span><span class="kwd">get</span><span class="pun">()</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> prop$delegate</span><span class="pun">.</span><span class="pln">getValue</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">::</span><span class="pln">prop</span><span class="pun">)</span><span class="pln">
</span><span class="pun">}</span></pre><p>请注意，provideDelegate 方法只影响辅助属性的创建，并不会影响为 getter 或 setter 生成的代码。</p>

			</div>
		</div>
	</div>
</div>

<!-- 右边栏 -->
<div class="fivecol last right-column">

<style>
.sidebar-tree .double-li {
	width:300px;
}
.sidebar-tree .double-li li {
    width: 44%;
    line-height: 1.5em;
    border-bottom: 1px solid #ccc;
    float: left;
    display: inline;
}
</style>

<style>
ol,ul{list-style:none}.cd-switcher a{text-decoration:none;outline:0}.cd-switcher a:hover{text-decoration:underline}a:focus{outline:0;-moz-outline:0}.main_nav{width:300px;height:60px;margin:60px auto 10px auto}.main_nav li{float:left;width:60px;margin-right:10px;font-size:16px;padding:.6em 1em;border-radius:3em;background:#2f889a;text-align:center}.main_nav li a{color:#fff}.errtip{background-color:#fceaea;color:#db5353;padding:8px 15px;font-size:14px;border:1px solid #fc9797;border-radius:5px}.cd-user-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(52,54,66,0.9);z-index:3;overflow-y:auto;cursor:pointer;visibility:hidden;opacity:0;-webkit-transition:opacity .3s 0,visibility 0 .3s;-moz-transition:opacity .3s 0,visibility 0 .3s;transition:opacity .3s 0,visibility 0 .3s}.cd-user-modal.is-visible{visibility:visible;opacity:1;-webkit-transition:opacity .3s 0,visibility 0 0;-moz-transition:opacity .3s 0,visibility 0 0;transition:opacity .3s 0,visibility 0 0}.cd-user-modal.is-visible .cd-user-modal-container{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);-o-transform:translateY(0);transform:translateY(0)}.cd-user-modal-container{position:relative;width:90%;max-width:500px;background:#FFF;margin:3em auto 4em;cursor:auto;border-radius:.25em;-webkit-transform:translateY(-30px);-moz-transform:translateY(-30px);-ms-transform:translateY(-30px);-o-transform:translateY(-30px);transform:translateY(-30px);-webkit-transition-property:-webkit-transform;-moz-transition-property:-moz-transform;transition-property:transform;-webkit-transition-duration:.3s;-moz-transition-duration:.3s;transition-duration:.3s}.cd-user-modal-container .cd-switcher:after{content:"";display:table;clear:both}.cd-user-modal-container .cd-switcher li{width:50%;float:left;text-align:center}.cd-user-modal-container .cd-switcher li:first-child a{border-radius:.25em 0 0 0}.cd-user-modal-container .cd-switcher li:last-child a{border-radius:0 .25em 0 0}.cd-user-modal-container .cd-switcher a{font-size:1.2em;font-weight:bold;display:block;width:100%;height:50px;line-height:50px;background:#e8f1e2;color:#96b880}.cd-user-modal-container .cd-switcher a.selected{background:#FFF;color:#505260}@media only screen and (min-width:600px){.cd-user-modal-container{margin:4em auto}.cd-user-modal-container .cd-switcher a{height:70px;line-height:70px}}.cd-form{padding:1.4em}.cd-form .fieldset{position:relative;margin:1.4em 0}.cd-form .fieldset:first-child{margin-top:0}.cd-form .fieldset:last-child{margin-bottom:0}.cd-form label{font-size:16px;font-size:.875rem}.cd-form label.image-replace{display:inline-block;position:absolute;left:15px;top:50%;bottom:auto;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);-o-transform:translateY(-50%);transform:translateY(-50%);height:20px;width:20px;overflow:hidden;text-indent:100%;white-space:nowrap;color:transparent;text-shadow:none;background-repeat:no-repeat;background-position:50% 0}.cd-form label.cd-username{background-image:url("/wp-content/themes/runoob/assets/img/cd-icon-username.svg")}.cd-form label.cd-email{background-image:url("/wp-content/themes/runoob/assets/img/cd-icon-email.svg")}.cd-form label.cd-password{background-image:url("/wp-content/themes/runoob/assets/img/cd-icon-password.svg")}.cd-form input{margin:0;padding:0;border-radius:.25em}.cd-form input.full-width{width:80%}.cd-form input.full-width2{width:94%}.cd-form input.has-padding{padding:12px 20px 12px 50px}.cd-form input.has-border{border:1px solid #d2d8d8;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none}.cd-form input.has-border:focus{border-color:#98b880;box-shadow:0 0 5px rgba(52,54,66,0.1);outline:0}.cd-form input.has-error{border:1px solid #d76666}.cd-form input[type=password]{padding-right:65px}.cd-form input[type=submit]{padding:16px 0;cursor:pointer;background:#96b97d;color:#FFF;font-weight:bold;border:0;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none;-o-appearance:none;appearance:none;font-size:1.2em;font-weight:bold}.no-touch .cd-form input[type=submit]:hover,.no-touch .cd-form input[type=submit]:focus{background:#3599ae;outline:0}@media only screen and (min-width:600px){.cd-form{padding:2em}.cd-form .fieldset{margin:2em 0}.cd-form .fieldset:first-child{margin-top:0}.cd-form .fieldset:last-child{margin-bottom:0}.cd-form input.has-padding{padding:16px 20px 16px 50px}.cd-form input[type=submit]{padding:16px 0}}.cd-close-form{display:block;position:absolute;width:40px;height:40px;right:0;top:-40px;background:url("/wp-content/themes/runoob/assets/img/cd-icon-close.svg") no-repeat center center;text-indent:100%;white-space:nowrap;overflow:hidden}@media only screen and (min-width:1170px){}#cd-login,#cd-signup,#cd-reset-password{display:none}#cd-login.is-selected,#cd-signup.is-selected,#cd-reset-password.is-selected{display:block}
</style>


</body></html>
